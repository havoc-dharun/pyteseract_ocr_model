steps:
- name: 'gcr.io/cloud-builders/docker'
  args: ['build', '-t', '$_IMAGE', '.']
- name: 'gcr.io/cloud-builders/docker'
  args: ['push', '$_IMAGE']
- name: 'gcr.io/google.com/cloudsdktool/cloud-sdk'
  entrypoint: gcloud
  args:
    - run
    - deploy
    - $_SERVICE
    - --image=$_IMAGE
    - --region=$_REGION
    - --allow-unauthenticated
    - --platform=managed
    - --set-env-vars=GEMINI_API_KEY=$_GEMINI_API_KEY,SERVICE_ACCOUNT_FILE=/app/credentials/service-account.json
images:
- '$_IMAGE'
substitutions:
  _IMAGE: gcr.io/$PROJECT_ID/ocr-app
  _SERVICE: ocr-app
  _REGION: us-central1
  _GEMINI_API_KEY: ''